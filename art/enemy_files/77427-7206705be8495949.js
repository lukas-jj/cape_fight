!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c2d513cd-d55a-40fc-9f1b-13cb82b6bf67",e._sentryDebugIdIdentifier="sentry-dbid-c2d513cd-d55a-40fc-9f1b-13cb82b6bf67")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[77427],{12881:function(e,t,r){r.d(t,{l:function(){return o}});var n=r(85893),i=r(33706);let o=(e,t)=>(0,n.jsxs)("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",className:(0,i.cn)("h-4 w-4 stroke-irGray-600 dark:stroke-white float-left ml-[1px] animate-spin-slow",t),xmlns:"http://www.w3.org/2000/svg",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,n.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),(0,n.jsx)("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),(0,n.jsx)("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),(0,n.jsx)("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),(0,n.jsx)("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),(0,n.jsx)("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),(0,n.jsx)("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),(0,n.jsx)("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]})},71189:function(e,t,r){var n=r(85893);r(67294);var i=r(9529),o=r(97861),a=r(61647);t.Z=()=>{var e;let{data:t}=(0,o.k)(),{handleManageAction:r}=(0,a.Z)();return(null==t?void 0:null===(e=t.result)||void 0===e?void 0:e.status)!=="incomplete"?null:(0,n.jsx)("div",{className:"flex dark:text-white right-1 bg-warning/30 dark:bg-warning/20  p-4 mt-8 rounded-lg text-sm text-center cursor-pointer",onClick:()=>{var e;r({activeSubscriptionId:null==t?void 0:null===(e=t.result)||void 0===e?void 0:e.stripeSubscriptionId})},children:(0,n.jsx)("span",{className:"w-full text-lg text-red-800  dark:text-red-100",children:(0,n.jsx)(i.vN,{keyName:"incomplete-payment-toast-message"})})})}},66083:function(e,t,r){r.d(t,{W:function(){return S}});var n=r(85893),i=r(82886),o=r(9529),a=r(85158),s=r(69391),l=r(77801),c=r(10777),u=r(98029),d=r(11163),p=r(67294),v=r(45777),m=r(7727);let f=async()=>{try{let{data:e}=await m.Z.post("".concat("https://api.imageresizer.com","/daily-quota/consume"));return{data:e,error:null}}catch(e){return{data:null,error:{message:e.message}}}},y=()=>({mutationFn:f,retry:5});var g=r(59602),h=r(41664),x=r.n(h),b=r(70300);let w="ir-user-type",S=()=>{let e=(0,a.g)(),{data:t,isFetching:r,isLoading:m}=(0,c.a)((0,g.o)()),f=(0,u.D)(y()),h=(null==t?void 0:t.data)||null,[S,k]=(0,p.useState)("free"),j=(0,d.useRouter)(),{t:I}=(0,b.$G)(),N=async()=>await e.ensureQueryData((0,g.o)()),C=async()=>{var t;let{data:r}=await N();if(!r)throw Error("Failed to fetch daily quota information");let n=(new Date().getTime()-r.fetchedAt)/1e3>30;if((null===(t=e.getQueryState((0,g.o)().queryKey))||void 0===t?void 0:t.fetchStatus)!=="fetching"&&r.fetchedAt&&n){await e.refetchQueries((0,g.o)());let t=await N();t.data&&(r=t.data)}return r},D=async()=>{let e=await C();return null===e.limit?1/0:Math.max(e.limit-e.usage,0)},R=t=>{e.setQueryData((0,g.o)().queryKey,e=>{let r=structuredClone(e);return(null==r?void 0:r.data)&&(r.data.usage+=t),r})},A=(0,l.V)("common:max-file-size-error-title"),U="".concat((0,l.V)("common:max-file-size-error-description",{size:h?(0,s.t)(h.fileSizeLimit):"10 MB"})),B=()=>"ultra"===localStorage.getItem(w)?null:(0,n.jsx)(o.vN,{keyName:"common:upgrade-to-convert-larger-files",overrideValue:z,linkRenderer:e=>(0,n.jsx)(x(),{href:E,className:"underline",onClick:e=>e.stopPropagation(),children:e})}),T=async()=>{let{data:e}=await N();return e&&"ultra"===e.userType?100:e&&"pro"===e.userType?20:5},E="en"===j.locale?"/pricing":"/".concat(j.locale,"/").concat(v.Z["/pricing"][j.locale||"en"]),Q=(0,l.V)("common:batch-limit-exceeded-title"),q=(0,l.V)("common:batch-limit-exceeded-msg",{size:"--"}),z=I("common:please-upgrade"),V=()=>"ultra"===localStorage.getItem(w)?null:(0,n.jsx)(o.vN,{keyName:"common:please-upgrade",overrideValue:z,linkRenderer:e=>(0,n.jsx)(x(),{href:E,className:"underline",onClick:e=>e.stopPropagation(),children:e})}),Z=async()=>{let e=await T();(0,i.Am)({title:Q,description:(0,n.jsxs)("div",{children:[q.replace("--","".concat(e)),(0,n.jsx)(V,{})]}),variant:"destructive",duration:1/0})},F=(0,l.V)("common:quota-limit-exceeded-toast-title"),L=(0,l.V)("common:quota-limit-exceeded-toast-description"),P=(0,l.V)("common:quota-limit-exceeded-deleted-images-toast-description"),_=I("common:upgrade-to-continue"),K=()=>"ultra"===localStorage.getItem(w)?null:(0,n.jsx)(o.vN,{keyName:"common:upgrade-to-continue",overrideValue:_,linkRenderer:e=>(0,n.jsx)(x(),{href:E,className:"underline",onClick:e=>e.stopPropagation(),children:e})});return(0,p.useEffect)(()=>{if(!h){let e=localStorage.getItem(w);e&&(0,p.startTransition)(()=>k(e));return}(0,p.startTransition)(()=>k(h.userType)),localStorage.setItem(w,h.userType)},[null==h?void 0:h.userType]),{userType:S,usageDetail:h,getRemainingQuota:D,ensureUsageDetail:N,isFetching:r,isLoading:m,invalidateDailyUsageQuery:()=>{e.invalidateQueries((0,g.o)())},consumeQuota:R,consumeQuotaByFrontendTool:()=>{R(1),f.mutate(void 0,{onSuccess:t=>{e.setQueryData((0,g.o)().queryKey,e=>{var r;let n=structuredClone(e);return(null==n?void 0:n.data)&&(n.data=null!==(r=t.data)&&void 0!==r?r:n.data),n})}})},showMaxFileSizeErrorToast:()=>{(0,i.Am)({title:A,description:(0,n.jsxs)(n.Fragment,{children:[U,(0,n.jsx)(B,{})]}),variant:"destructive",duration:1/0})},getBatchLimit:T,showBatchLimitErrorToast:Z,showQuotaLimitExceededToast:()=>{(0,i.Am)({title:F,description:(0,n.jsxs)("div",{children:[L," ",(0,n.jsx)(V,{})]}),variant:"destructive",duration:1/0})},showQuotaLimitExceededDeletedImagesToast:()=>{(0,i.Am)({title:F,description:(0,n.jsxs)("div",{children:[P," ",(0,n.jsx)(K,{})]}),variant:"destructive",duration:1/0})},getRemainingQuotaSynchronously:()=>{let t=e.getQueryData((0,g.o)().queryKey);if(!t||!t.data||t.error)throw Error("Usage detail not fetched yet");let{limit:r,usage:n}=t.data;return null===r?1/0:Math.max(r-n,0)},getBatchLimitSynchronously:()=>{let t=e.getQueryData((0,g.o)().queryKey);if(!t||!t.data||t.error)throw Error("Usage detail not fetched yet");let r=t.data.userType;return"ultra"===r?100:"pro"===r?20:5}}}},97861:function(e,t,r){r.d(t,{k:function(){return a}});var n=r(10777),i=r(28675),o=r(66347);function a(){let{isLoggedIn:e}=(0,o.Z)();return(0,n.a)({queryKey:["activeSubscriptionQuery"],enabled:e(),queryFn:async()=>i.B.getActiveSubscription()})}},61647:function(e,t,r){r.d(t,{t:function(){return y},Z:function(){return f}});var n=r(28675),i=r(82886),o=r(66347),a=r(89018),s=r(67294),l=r(97861),c=r(50281),u=r(31955);let d=(e,t,r)=>{u.Z.set(e,t,{expires:(null==r?void 0:r.expires)||7,path:(null==r?void 0:r.path)||"/",secure:(null==r?void 0:r.secure)||!1})},p=e=>u.Z.get(e),v=e=>{u.Z.remove(e)};var m=r(11163),f=e=>{var t;let r=(0,m.useRouter)(),[u,f]=(0,s.useState)(!1),{isLoggedIn:g}=(0,o.Z)(),{toast:h}=(0,i.pm)(),{refetch:x,data:b,promise:w}=(0,l.k)(),S=!!(null==b?void 0:null===(t=b.result)||void 0===t?void 0:t.stripeSubscriptionId);function k(e){try{d("dashboardRedirectAction",(0,c.Ne)(e),{expires:new Date(Date.now()+18e4)})}catch(e){console.error(e)}}function j(){try{v("dashboardRedirectAction")}catch(e){console.error(e)}}let I=async()=>{try{let t=p("dashboardRedirectAction");if(t){let n=JSON.parse((0,c.Vy)(t));if(n.type===y.subscribe){var e;let t=await w;(null==t?void 0:null===(e=t.result)||void 0===e?void 0:e.stripeSubscriptionId)||N(n.planId)}else n.type===y.freeDowngrade||n.type===y.redirect&&n.url&&r.push(n.url);j()}}catch(e){console.error(e)}},N=async e=>{var t,i,o;if(!g()){let t=JSON.stringify({type:"subscribe",planId:e});k(t),r.push("".concat(a.n.signupRoute,"?redirectAction=").concat((0,c.Ne)(t)));return}if(!e){if(g()&&S&&(null==b?void 0:null===(t=b.result)||void 0===t?void 0:t.irSubscriptionStatus)=="active"){let e=JSON.stringify({type:y.freeDowngrade});r.push("".concat(a.n.dashboardRoute,"?redirectAction=").concat((0,c.Ne)(e)))}else r.push(a.n.dashboardRoute);return}if(S)return C({activeSubscriptionId:null==b?void 0:null===(i=b.result)||void 0===i?void 0:i.stripeSubscriptionId,isUpgrade:(null==b?void 0:null===(o=b.result)||void 0===o?void 0:o.status)==="active"});if(u)return;if(f(!0),!g()){window.location.href=a.n.loginRoute;return}let s=await n.B.createPaymentLink({planId:e});if(f(!1),j(),console.log(s),s.error){console.error(s.error),h({title:"Error",variant:"destructive",description:s.error.message});return}window.location.href=s.result.url,f(!1)},C=async e=>{let{activeSubscriptionId:t,isUpgrade:i}=e;if(!g()){r.push(a.n.loginRoute);return}if(!t){r.push(a.n.pricing);return}if(!u){f(!0);try{let e=await n.B.createCustomerPortalSession({activeSubscriptionId:i?t:void 0});if(f(!1),console.log(e),e.error){console.error(e.error);return}if(!e.result){h({title:"Error",variant:"destructive",description:"Unable to create customer portal session"});return}e.result.url&&r.push(e.result.url)}catch(e){console.error(e)}f(!1)}};return{handleSubscribeAction:N,isBusy:u,handleManageAction:C,activeSubscription:b,setDashboardRedirectAction:k,refreshSubscriptionIfNeeded:async()=>{var e,t;if(!g())return;let r=await w,i=null==r?void 0:null===(e=r.result)||void 0===e?void 0:e.stripeSubscriptionId;if(i&&(null==r?void 0:null===(t=r.result)||void 0===t?void 0:t.status)==="incomplete")try{await n.B.refreshSubscription(i)&&x()}catch(e){console.error(e)}},handleDashboardRedirectAction:I}};let y={subscribe:"subscribe",freeDowngrade:"freeDowngrade",redirect:"redirect"}},28675:function(e,t,r){r.d(t,{B:function(){return l}});var n=r(9669),i=r.n(n);class o{static get baseUrlAccountServer(){return"https://account.imageresizer.com"}static get baseUrlBackendServer(){return"https://api.imageresizer.com"}}let a=i().create({baseURL:o.baseUrlAccountServer,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/auth/login"),Promise.reject(e)});class s{}s.post=async(e,t,r)=>{let n=null,i=null;try{n=(await a.post(e,t,{headers:{...null!=r?r:{}}})).data}catch(e){var o,s,l,c,u,d,p;i={message:(null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:null===(o=s.message)||void 0===o?void 0:o.toString())||(null===(d=e.response)||void 0===d?void 0:null===(u=d.data)||void 0===u?void 0:null===(c=u.error)||void 0===c?void 0:c.toString())||e.message,code:e.code||"".concat(null===(p=e.response)||void 0===p?void 0:p.status)}}return{result:n,error:i}},s.get=async e=>{let t=null,r=null;try{t=(await a.get(e)).data}catch(e){var n,i;r={message:e.message,code:e.code||(null===(i=e.response)||void 0===i?void 0:null===(n=i.status)||void 0===n?void 0:n.toString())}}return{result:t,error:r}};class l{}l.createPaymentLink=async e=>await s.post("/stripe/create/payment-link",e),l.createCustomerPortalSession=async e=>{let{activeSubscriptionId:t}=e;return await s.post("/stripe/create/customer-portal-session",{activeSubscriptionId:t})},l.getCheckoutSession=async e=>await s.get("/stripe/checkout-session/".concat(e)),l.getActiveSubscription=async()=>await s.get("/subscription/current"),l.getAllSubscription=async()=>await s.get("/subscription/all"),l.refreshSubscription=async e=>await s.post("/subscription/refresh/".concat(e),{})},50281:function(e,t,r){r.d(t,{Ne:function(){return i},Vy:function(){return o}});var n=r(48764).lW;let i=e=>n.from(e).toString("base64"),o=e=>n.from(e,"base64").toString("utf-8")},31955:function(e,t,r){function n(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}r.d(t,{Z:function(){return i}});var i=function e(t,r){function i(e,i,o){if("undefined"!=typeof document){"number"==typeof(o=n({},r,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var s in o)o[s]&&(a+="; "+s,!0!==o[s]&&(a+="="+o[s].split(";")[0]));return document.cookie=e+"="+t.write(i,e)+a}}return Object.create({set:i,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},i=0;i<r.length;i++){var o=r[i].split("="),a=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(n[s]=t.read(a,s),e===s)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){i(e,"",n({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,n({},this.attributes,t))},withConverter:function(t){return e(n({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}}]);
//# sourceMappingURL=77427-7206705be8495949.js.map